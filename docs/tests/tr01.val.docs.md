### **T06 Caso de prueba: Validación completa con emails distintos en solicitud y comercio (tr01)**

---

#### 1. **Preparación del entorno**

* Ejecutar `prepararEscenario('tr01')` para generar una solicitud con datos de comercio y PDF temporal.
* Guardar el PDF recibido (`comprobante.pdf`) en una ruta temporal (`tempPath`).
* Extraer el token OTP devuelto por el backend.

---

#### 2. **Pantalla inicial – Validación de Identidad**

* Abrir la pantalla de registro usando el `token`.
* Verificar que el paso actual sea "Validación de Identidad".
* Comprobar que los botones `Siguiente` y `Validar` estén deshabilitados.
* Verificar que el campo `empresa-p` muestre "GEOSOFT INTERNACIONAL SRL".

---

#### 3. **Verificación en la aplicación pública (antes de validar)**

* Navegar a `/bolivia/la-paz/geosoft-internacional-srl`.
* Verificar que la tarjeta del comercio muestre "Email no disponible".

---

#### 4. **Carga y validación de documentos (NIT y CI)**

* Regresar al registro (`/app/registro-comercio?token=...`).
* Cargar el archivo `NIT-GEOSOFT.pdf` en el input correspondiente.
* Cargar el archivo `CI.jpg` en su input correspondiente.
* Hacer clic en el botón `Validar`.
* Esperar una respuesta HTTP 200 desde `/api/documentos`.
* Verificar que se muestre el texto "Registro Validado".
* Verificar que el botón `Siguiente` esté habilitado.
* Hacer clic en `Siguiente` y confirmar que el nuevo paso es "Información del Comercio".

---

#### 5. **Verificación en la aplicación pública (post validación)**

* Navegar a `/bolivia/la-paz/geosoft-internacional-srl`.
* Verificar que ahora se muestre "Email disponible".

---

#### 6. **Paso: Información del Comercio – Substep 1**

* Seleccionar el plan "De Pago".
* Seleccionar ciudad: La Paz (ID: 7).
* Seleccionar zona: San Jorge (ID: 3).
* Completar dirección:

  * Zona: `14 DE SEPTIEMBRE`
  * Calle: `CALLE 9 ESQUINA A`
  * Planta: `SEGUNDO PISO`
  * Local: `12B`
* Avanzar con botón `Siguiente` y verificar que se mantiene el paso "Información del Comercio".

---

#### 7. **Paso: Información del Comercio – Substep 2**

* Ingresar teléfonos:

  * Teléfono 1: `72123456`
  * Teléfono 2: `76543210`
  * WhatsApp: `59172123456`
* Ingresar página web: `https://geosoft.bo`
* Completar campos de texto:

  * Servicios: `SISTEMAS WEB, APP MÓVILES, CLOUD`
  * Palabras clave: `ESPERICAURICONO`
* Avanzar al siguiente paso y verificar que se muestre "Pago del Plan".

---

#### 8. **Paso: Pago del Plan**

* Cargar el PDF temporal (`tempPath`) en el input `comprobante-input`.
* Verificar que el botón `Validar` esté habilitado.
* Hacer clic en `Validar` y esperar respuesta HTTP 200.
* Verificar que el botón `Siguiente` se habilite.
* Avanzar al paso final y verificar que se muestre "Autorización".

---

#### 9. **Paso: Autorización y finalización**

* Marcar el checkbox de autorización.
* Verificar que el botón `Terminar` esté habilitado.
* Hacer clic en `Terminar` y esperar respuesta HTTP 200 desde `/api/comercios`.

---

#### 10. **Verificación final en la aplicación pública**

* Navegar a `/bolivia/la-paz/espericauricono`.
* Verificar que el comercio aparece:

  * Con email disponible.
  * Con nombre: `GEOSOFT INTERNACIONAL SRL`.
  * Con servicios: `SISTEMAS WEB, APP MÓVILES, CLOUD`.
  * Con dirección: `CALLE 9 ESQUINA A, 14 DE SEPTIEMBRE`.
  * Con teléfonos: `72123456, 76543210`.

---

#### 11. **Verificación del detalle del comercio (modal)**

* Hacer clic sobre la tarjeta del comercio.
* Verificar en el modal:

  * Título: `GEOSOFT INTERNACIONAL SRL`.
  * Estado: `Comercio validado`.
  * Zona: `14 DE SEPTIEMBRE`.
  * Dirección: `CALLE 9 ESQUINA A`.
  * Servicios: `SISTEMAS WEB, APP MÓVILES, CLOUD`.
  * Teléfonos: `72123456`, `76543210`.
  * Botones visibles: `Enviar Correo`, `Ver Mapa`, `WhatsApp`.
  * Botón de cerrar (`✕`) visible.

