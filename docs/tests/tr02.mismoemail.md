# TR02 – Comercio con email igual en solicitud y comercio

## Objetivo

Validar que el flujo de inscripción de un comercio donde el **email de la solicitud coincide con el del comercio existente** funcione correctamente, incluyendo selección de plan, validación de inmutabilidad de campos de pago, validación de comprobante y autorización final.

---

## Preparación

- Preparar el escenario en backend con el endpoint `/solicitudes/preparar_escenario` usando el identificador `tr02`.
- Obtener el `token` generado para el flujo de inscripción.
- Asegurarse de que el comercio esté configurado con:
  - Documentos validados.
  - Email coincidente con el de la solicitud.

---

## Acciones y Verificaciones

### 1. Acceso inicial

- Acceder al link con `token`.
- **Verificar:** El título mostrado es **“Información del Comercio”**.

### 2. Selección de plan

- **Verificar:** El plan gratuito está seleccionado por defecto.
- Cambiar a plan **De Pago**.

### 3. Edición de datos (Substep 1)

- Seleccionar:
  - Ciudad: **Oruro**.
  - Zona: **Central**.
- Llenar:
  - Nombre de zona: **14 DE SEPTIEMBRE**.
  - Dirección: **AYACUCHO Nº s/n**.
  - Planta: vacío.
  - Número local: vacío.
- **Verificar:** Avanza al siguiente subpaso.

### 4. Edición de datos (Substep 2)

- Llenar:
  - Teléfono 1: **72300013**.
  - Teléfono 2: vacío.
  - WhatsApp: **59172300013**.
  - Página web: **https://vasquez.com.bo**.
  - Servicios: **COMERCIALIZACIÓN VARIADA**.
  - Palabras clave: **VASQUEZ ORURO**.

### 5. Cambio a plan gratuito (inmutabilidad)

- Volver a seleccionar plan **Gratuito**.
- **Verificar errores mostrados en rojo**:
  - `error-telefono_whatsapp` visible.
  - `error-pagina_web` visible.
  - `error-servicios` visible.
- **Verificar valores**:
  - WhatsApp mantiene valor **59172300013**.
  - Página web y Servicios quedan **vacíos**.

### 6. Regreso a plan de pago

- Seleccionar nuevamente plan **De Pago**.
- Volver a llenar campos de pago:
  - WhatsApp: **59172300013**.
  - Página web: **https://vasquez.com.bo**.
  - Servicios: **COMERCIALIZACIÓN VARIADA**.
  - Palabras clave: **VASQUEZ ORURO**.
- **Verificar:** Se permite avanzar al paso de pago.

### 7. Pago del plan

- Subir comprobante PDF.
- Pulsar **Validar**.
- **Verificar:** Llega respuesta exitosa y se habilita avanzar.

### 8. Autorización

- Avanzar a pantalla de **Autorización**.
- Marcar el checkbox **Sí autorizo**.
- Pulsar **Terminar**.
- **Verificar:** Se guarda el comercio y el flujo finaliza.

### 9. Verificación final en frontend

- Ingresar a `/bolivia/oruro/vasquez-oruro`.
- **Verificar tarjeta del comercio**:
  - Texto **Email disponible**.
  - Nombre **COMERCIAL VASQUEZ**.
  - Servicios **COMERCIALIZACIÓN VARIADA**.
  - Dirección **AYACUCHO Nº s/n, 14 DE SEPTIEMBRE**.
  - Teléfono **72300013**.
- **Verificar modal del comercio**:
  - Encabezado con **COMERCIAL VASQUEZ**.
  - Estado **Comercio validado**.
  - Zona, dirección, servicios y teléfonos visibles.
  - Botones **Enviar Correo**, **Ver Mapa** y **WhatsApp** disponibles.

---

## Resultado esperado

El flujo de inscripción concluye con éxito mostrando el mensaje de validación. El comercio queda registrado con plan de pago, datos editados, comprobante validado y autorización otorgada. Además:

- La transición **pago → gratuito → pago** funciona correctamente.
- Los campos de pago son **inmutables en gratuito** y se restauran a sus valores previos, con mensajes de error visibles.
- La información final es consistente en la tarjeta y el modal del frontend.
